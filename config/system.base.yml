# ============================================================================
# Base Configuration - Ortak Ayarlar
# ============================================================================
# Bu dosya research ve live profilleri için ortak ayarları içerir.
# Semboller, feature'lar, risk parametreleri, strateji tanımları burada.

# Mode will be overridden by profile configs (research/live)
mode: "base"

# Default symbol and timeframe (can be overridden)
symbol: "AIAUSDT"
timeframe: "15m"

# ============================================================================
# DATA - Veri Kaynakları ve Semboller
# ============================================================================
data:
  ohlcv_dir: "data/ohlcv"
  external_dir: "data/external"
  features_dir: "data/features"
  flow_dir: "data/flow"
  sentiment_dir: "data/sentiment"
  backend: "csv"  # csv | timescale | duckdb
  backend_params: {}

  # Research universe - geniş sembol ve timeframe seti
  symbols:
    - "AIAUSDT"
    - "BTCUSDT"
    - "ETHUSDT"
    - "BNBUSDT"
    - "XRPUSDT"

  timeframe: "15m"  # Legacy single timeframe (for backward compatibility)
  timeframes:
    - "1m"
    - "5m"
    - "15m"
    - "1h"

  ohlcv_path_template: "data/ohlcv/{symbol}_{timeframe}.csv"

  lookback_days:
    "1m": 90
    "5m": 90
    "15m": 180
    "1h": 365
  default_lookback_days: 365

  bars:
    mode: "time"   # time | volume | dollar | tick
    target_volume: 2000000
    target_notional: null
    target_ticks: null

  day_type:
    trend_body_to_range_min: 0.6
    range_body_to_range_max: 0.4
    liquidation_wick_to_range_min: 0.5
    liquidation_volume_z: 2.0

# ============================================================================
# FEATURES - Feature Engineering Ayarları
# ============================================================================
features:
  use_base: true
  use_ta: true
  use_candles: true
  use_osc: true
  use_htf: true
  use_microstructure: true
  use_market_structure: true
  use_external: true
  use_rule_signals: true
  use_flow_features: true
  use_sentiment_features: true
  drop_na: true
  feature_preset: "extended"

# ============================================================================
# RISK - Risk Yönetimi Parametreleri
# ============================================================================
risk:
  capital_risk_pct_per_trade: 0.01
  max_leverage: 5.0
  max_notional_per_symbol: 2000.0
  max_daily_loss_pct: 0.03
  daily_loss_lookback_days: 1
  min_hold_bars: 2
  use_tail_risk_guard: true
  tail_risk_hv_threshold: 0.25
  tail_risk_max_leverage_in_crash: 1.0
  atr_period: 14
  atr_mult_tp: 1.5
  atr_mult_sl: 1.0
  warmup_bars: 50

# ============================================================================
# RULE STRATEGY - Rule-based Strategy Parametreleri
# ============================================================================
rule:
  allowed_hours: [8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
  allowed_weekdays: [0, 1, 2, 3, 4]
  htf_trend_min: -0.05
  htf_rsi_min: 40.0
  htf_rsi_max: 75.0
  atr_pct_min: 0.002
  atr_pct_max: 0.08
  rsi_entry_min: 45.0
  rsi_entry_max: 75.0
  macd_entry_min: -0.001
  stoch_k_entry_min: 20.0
  stoch_k_entry_max: 85.0
  min_body_pct: 0.08
  trend_exit_max: -0.10
  rsi_exit_max: 45.0
  use_ms_trend_filter: true
  ms_trend_min: -0.5
  ms_trend_max: 1.5
  use_ms_chop_filter: true
  allow_chop: false
  use_fvg_filter: false

# ============================================================================
# ML - Machine Learning Ayarları
# ============================================================================
ml:
  enabled: true
  targets:
    # ML training is computationally expensive - limit to specific symbol/timeframe combos
    # If empty, defaults to first symbol/timeframe from data.symbols/data.timeframes
    - symbol: "BTCUSDT"
      timeframe: "15m"
    - symbol: "AIAUSDT"
      timeframe: "15m"
    # Uncomment to add more targets:
    # - symbol: "BTCUSDT"
    #   timeframe: "1h"
  label:
    method: "fixed_horizon"
    horizon_bars: 8
    up_threshold: 0.004
    down_threshold: -0.004
  model:
    type: "RandomForest"
    n_estimators: 200
    max_depth: 6
    min_samples_leaf: 50
    random_state: 42
  backtest:
    proba_column: "ml_proba_long"
    proba_threshold: 0.55
    proba_exit_threshold: 0.50
    warmup_bars: 200
    side: "long_only"
    allow_pipeline_mismatch: false
    use_saved_model: false
    model_id: null
  persistence:
    save_model: true
    model_dir: "outputs/ml_models"
    use_registry: true
    max_models_per_symbol_tf: 10
  registry:
    use_latest: true
    selected_id: null

# ============================================================================
# STRATEGY - Strateji Tanımları
# ============================================================================
strategy:
  default: "rule"
  rule: {}
  ml: {}
  trend_continuation: {}
  sweep_reversal: {}
  volatility_breakout: {}

# ============================================================================
# SCENARIO - Scenario Presets
# ============================================================================
scenario:
  presets:
    core_15m:
      - name: "rule_ms_on"
        strategy_name: "rule"
        strategy_params:
          use_ms_trend_filter: true
        risk_params: {}
      - name: "trend_cont_low_risk"
        strategy_name: "trend_continuation"
        strategy_params: {}
        risk_params:
          capital_risk_pct_per_trade: 0.01
      - name: "vol_breakout_aggr"
        strategy_name: "volatility_breakout"
        strategy_params:
          min_contraction: 0.008
        risk_params:
          capital_risk_pct_per_trade: 0.02

# ============================================================================
# PORTFOLIO - Portfolio Ayarları
# ============================================================================
portfolio:
  symbols:
    - AIAUSDT
    - BTCUSDT
  timeframe: "15m"
  strategy: "rule"
  initial_capital: 1000.0
  capital_allocation:
    type: "equal_weight"
    weights: {}

# ========================================================================
# WAREHOUSE / STATE
# ========================================================================
warehouse:
  backend: timescale
  dsn: ${FT_TIMESCALE_DSN}
  ohlcv_table: raw_ohlcv
  funding_table: raw_funding_rates
  open_interest_table: raw_open_interest
  flow_table: raw_flow
  sentiment_table: raw_sentiment
  live_batch_size: 500
