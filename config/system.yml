symbol: "AIAUSDT"
timeframe: "15m"

exchange:
  name: "binance_futures"
  testnet: true
  dry_run: true
  base_url_rest: "https://fapi.binance.com"
  base_url_rest_testnet: "https://testnet.binancefuture.com"
  base_url_ws: "wss://fstream.binance.com"
  base_url_ws_testnet: "wss://stream.binancefuture.com"
  api_key_env: "BINANCE_FUTURES_API_KEY"
  secret_key_env: "BINANCE_FUTURES_API_SECRET"
  api_key: "${BINANCE_FUTURES_API_KEY}"
  secret_key: "${BINANCE_FUTURES_API_SECRET}"
  recv_window_ms: 5000
  time_sync: true
  max_time_skew_ms: 1000
  symbol_mapping:
    AIAUSDT: "AIAUSDT"
    BTCUSDT: "BTCUSDT"
  default_leverage: 5
  position_mode: "one_way"
  max_leverage: 3
  max_position_notional: 200.0
  max_position_contracts: 0.05

data:
  ohlcv_dir: "data/ohlcv"
  external_dir: "data/external"
  features_dir: "data/features"
  symbols:
    - "AIAUSDT"
    - "BTCUSDT"
  timeframe: "15m"
  ohlcv_path_template: "data/ohlcv/{symbol}_{timeframe}.csv"
  flow_dir: "data/flow"
  sentiment_dir: "data/sentiment"
  bars:
    mode: "time"   # time | volume | dollar | tick
    target_volume: 2000000
    target_notional: null
    target_ticks: null
  day_type:
    trend_body_to_range_min: 0.6
    range_body_to_range_max: 0.4
    liquidation_wick_to_range_min: 0.5
    liquidation_volume_z: 2.0

features:
  use_base: true
  use_ta: true
  use_candles: true
  use_osc: true
  use_htf: true
  use_microstructure: true
  use_market_structure: true
  use_external: true
  use_rule_signals: true
  use_flow_features: true
  use_sentiment_features: true
  drop_na: true
  feature_preset: "extended"

rule:
  allowed_hours: [8, 9, 10, 11, 12, 13, 14, 15, 16, 17]
  allowed_weekdays: [0, 1, 2, 3, 4]
  htf_trend_min: -0.05
  htf_rsi_min: 40.0
  htf_rsi_max: 75.0
  atr_pct_min: 0.002
  atr_pct_max: 0.08
  rsi_entry_min: 45.0
  rsi_entry_max: 75.0
  macd_entry_min: -0.001
  stoch_k_entry_min: 20.0
  stoch_k_entry_max: 85.0
  min_body_pct: 0.08
  trend_exit_max: -0.10
  rsi_exit_max: 45.0
  use_ms_trend_filter: true
  ms_trend_min: -0.5
  ms_trend_max: 1.5
  use_ms_chop_filter: true
  allow_chop: false
  use_fvg_filter: false

risk:
  capital_risk_pct_per_trade: 0.01
  max_leverage: 5.0
  max_notional_per_symbol: 2000.0
  max_daily_loss_pct: 0.03
  daily_loss_lookback_days: 1
  min_hold_bars: 2
  use_tail_risk_guard: true
  tail_risk_hv_threshold: 0.25
  tail_risk_max_leverage_in_crash: 1.0
  atr_period: 14
  atr_mult_tp: 1.5
  atr_mult_sl: 1.0
  warmup_bars: 50

ml:
  label:
    method: "fixed_horizon"
    horizon_bars: 8
    up_threshold: 0.004
    down_threshold: -0.004
  model:
    type: "RandomForest"
    n_estimators: 200
    max_depth: 6
    min_samples_leaf: 50
    random_state: 42
  backtest:
    proba_column: "ml_proba_long"
    proba_threshold: 0.55
    proba_exit_threshold: 0.50
    warmup_bars: 200
    side: "long_only"
    allow_pipeline_mismatch: false
    use_saved_model: false
    model_id: null
  persistence:
    save_model: true
    model_dir: "outputs/ml_models"
    use_registry: true
    max_models_per_symbol_tf: 10
  registry:
    use_latest: true
    selected_id: null

strategy:
  default: "rule"
  rule: {}
  ml: {}
  trend_continuation: {}
  sweep_reversal: {}
  volatility_breakout: {}

live:
  mode: "paper"               # "paper" | "exchange"
  symbols:
    - "AIAUSDT"
  data_source: "replay"       # "replay" | "binance_ws"
  exchange: "binance_futures"
  symbol: "AIAUSDT"
  timeframe: "15m"
  ws_enabled: false
  rest_poll_sec: 5
  max_concurrent_positions: 1
  max_position_notional: 100.0
  max_daily_loss: 20.0
  max_open_trades: 3
  order_retry_limit: 3
  order_timeout_seconds: 5
  log_dir: "outputs/live_logs"
  log_level: "INFO"
  heartbeat_path: "outputs/live/heartbeat_{run_id}.json"
  replay:
    bars_limit: 500
    start_index: 0
    start_timestamp:
  paper:
    initial_cash: 10000
    save_state_every_n_bars: 25
    state_path: "outputs/live_state/paper_state.json"
    output_dir: "outputs/live_paper"
  execution:
    allow_market_orders: true
    allow_limit_orders: true
  ws:
    use_1m_stream: true
    aggregate_to_tf: "15m"
    resync_lookback_bars: 200
    max_stale_seconds: 30
    max_ws_reconnects: 10

kill_switch:
  enabled: true
  daily_realized_pnl_limit: -20.0
  max_equity_drawdown_pct: 30.0
  max_exceptions_per_hour: 5
  min_equity: 100.0
  evaluation_interval_bars: 1

notifications:
  enabled: true
  fcm:
    enabled: true
    server_key: "${FCM_SERVER_KEY}"
    topic: "finantrade"
    min_level: "info"

scenario:
  presets:
    core_15m:
      - name: "rule_ms_on"
        strategy_name: "rule"
        strategy_params:
          use_ms_trend_filter: true
        risk_params: {}
      - name: "trend_cont_low_risk"
        strategy_name: "trend_continuation"
        strategy_params: {}
        risk_params:
          capital_risk_pct_per_trade: 0.01
      - name: "vol_breakout_aggr"
        strategy_name: "volatility_breakout"
        strategy_params:
          min_contraction: 0.008
        risk_params:
          capital_risk_pct_per_trade: 0.02

portfolio:
  symbols:
    - AIAUSDT
    - BTCUSDT
  timeframe: "15m"
  strategy: "rule"
  initial_capital: 1000.0
  capital_allocation:
    type: "equal_weight"
    weights: {}
