# How to Use Market Structure Features in Strategies

This document provides a guide on how to interpret the market structure columns generated by the `MarketStructureEngine` and how to use them to build trading strategies.

## Column Definitions

The engine produces the following columns, each prefixed with `ms_`:

-   `ms_swing_high`, `ms_swing_low`
    -   **Type**: Binary (0 or 1)
    -   **Represents**: A '1' on a given bar indicates that a swing high or swing low point has just been confirmed at that bar's high/low. These are the foundational points for all other market structure analysis.

-   `ms_trend_regime`
    -   **Type**: Integer (1, -1, or 0)
    -   **Represents**: The current market trend based on the sequence of swing points.
        -   `1`: Uptrend (Higher Highs and Higher Lows).
        -   `-1`: Downtrend (Lower Highs and Lower Lows).
        -   `0`: Ranging or undetermined trend.

-   `ms_bos_up`, `ms_bos_down`
    -   **Type**: Binary (0 or 1)
    -   **Represents**: A "Break of Structure." A '1' signals that a recent swing high (in an uptrend) or swing low (in a downtrend) has been broken, confirming trend continuation.
        -   `ms_bos_up = 1`: Price broke a previous swing high in an uptrend.
        -   `ms_bos_down = 1`: Price broke a previous swing low in a downtrend.

-   `ms_choch`
    -   **Type**: Binary (0 or 1)
    -   **Represents**: A "Change of Character." In the current implementation, this flags the bar where `ms_trend_regime` flips from `1` to `-1` or vice-versa. It suggests a potential reversal of the established trend.

-   `ms_fvg_up`, `ms_fvg_down`
    -   **Type**: Binary (0 or 1)
    -   **Represents**: A "Fair Value Gap" or price imbalance. A '1' indicates an FVG was formed on the *previous* bar, representing an inefficient price move that the market may later try to "fill."
        -   `ms_fvg_up = 1`: A bullish FVG (a gap between bar `i-2`'s high and bar `i`'s low). A potential support area.
        -   `ms_fvg_down = 1`: A bearish FVG (a gap between bar `i-2`'s low and bar `i`'s high). A potential resistance area.

-   `ms_zone_demand`, `ms_zone_supply`
    -   **Type**: Float (>= 0.0)
    -   **Represents**: Indicates if the current bar's close price is inside a supply or demand zone. The value itself is the "strength" of the zone, calculated from the number of swing point touches and the volume profile. A value of `0.0` means the price is not in a zone of that type.

## Example Strategy Snippets

These are conceptual rules showing how to combine the features.

### 1. Trend Continuation (Momentum Entry)

**Goal**: Enter a long position when an uptrend is confirmed by a Break of Structure.

**Logic**:
- The market must be in a clear uptrend.
- A Break of Structure must have just occurred, confirming the trend's strength.
- As a filter, ensure we are not buying directly into a strong area of overhead supply.

```python
# Conceptual rule for a single bar
is_uptrend = df['ms_trend_regime'].iloc[-1] == 1
just_broke_structure = df['ms_bos_up'].iloc[-1] == 1
not_in_supply = df['ms_zone_supply'].iloc[-1] == 0.0

if is_uptrend and just_broke_structure and not_in_supply:
    # GO LONG
    entry_signal = 1
```

### 2. Sweep + FVG Reversal (Mean Reversion Entry)

**Goal**: In an uptrend, wait for a liquidity sweep below a recent low and enter long when price reclaims a bullish FVG. This is a more advanced "buy the dip" strategy.

**Logic**:
- The overall market must be in an uptrend.
- Identify a short-term dip where price fills a recent bullish FVG. This acts as a support zone.
- A common pattern is that price will first dip *below* a recent swing low (a "sweep") before reversing. A simpler entry is to just look for the FVG fill.

```python
# Conceptual rule for a single bar
is_uptrend = df['ms_trend_regime'].iloc[-1] == 1

# Find the last bar that had a bullish FVG
fvg_was_present = df['ms_fvg_up'].shift(1).iloc[-1] > 0 # shift(1) to check previous bar

# The current bar's low has now entered the price range of that FVG
# (This requires getting the FVG's price boundaries, which is more complex)
# A simplified proxy:
price_is_dropping = df['close'].iloc[-1] < df['close'].iloc[-2]

# Condition: We are in an uptrend, and price is dropping to fill a recently-formed FVG.
if is_uptrend and fvg_was_present and price_is_dropping:
    # GO LONG (expecting the FVG to act as support)
    entry_signal = 1
```
